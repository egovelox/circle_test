version: 2.1
jobs:
  my_build:
    executor: node/default
    steps:
      - checkout
      - node/install-packages:
          cache-path: ~/project/node_modules
          override-ci-command: npm install
      - run: npm run build
      - persist_to_workspace:
          root: ./
          paths:
            - ./

  my_deploy:
    machine: true
    steps:
      - attach_workspace:
          at: ./
      - add_ssh_keys:
          fingerprints:
            - "90:0e:ef:fd:f1:21:9e:05:6a:fb:1a:d8:00:35:21:53"
            - run: scp -r ./dist $USER@$HOST:$DEST_PATH 

orbs:
  node: circleci/node@3.0.0
workflows:
  build-my-webpage:
    jobs:
      - my_build
      - my_deploy:
          requires:
            - my_build
